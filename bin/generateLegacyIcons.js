const glob = require('glob');
const fs = require('fs-extra');
const path = require('path');
const kebabCase = require('lodash/kebabCase');

/**
 * Dist directory
 * @type {string}
 */
const DIST_DIR = '../src/icons/legacy';

const resolvePath = (...paths) => path.resolve(__dirname, ...paths);

module.exports = function() {
  const files = glob.sync(resolvePath('../node_modules/rsuite-icon-font/lib/*.js'));
  files.forEach(function generateComponent(svgPath, index) {
    const basename = path.basename(svgPath);
    const componentName = path.basename(basename, path.extname(basename));
    const kebabCaseName = kebabCase(componentName);
    console.log(`(${index + 1}/${files.length}) Generating ${componentName}.tsx ...`);
    fs.outputFileSync(
      resolvePath(DIST_DIR, `${componentName}.tsx`),
      `// Generated by script, don't edit it please.
import React from 'react';
import { defaultProps, propTypes, IconBaseProps, default as Icon } from '../../IconBase';
import ${componentName}Svg from 'rsuite-icon-font/lib/${componentName}';

type IconProps = Omit<IconBaseProps, 'baseClassName'>;

const ${componentName}: React.FC<IconProps> = React.forwardRef<HTMLSpanElement, IconProps>(
  function ${componentName}(props: IconProps, ref: React.Ref<HTMLSpanElement>) {
    return <Icon {...props} aria-label="${kebabCaseName}" role="img" ref={ref} as={${componentName}Svg} />;
  }
);

${componentName}.displayName = '${componentName}';
${componentName}.propTypes = propTypes;
${componentName}.defaultProps = defaultProps;

export default ${componentName};
`
    );
  });
};
